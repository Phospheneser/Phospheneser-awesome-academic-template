<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zhe Xu - Homepage</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-R2ZLMKHR2E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-R2ZLMKHR2E');
  </script>

  <script>
    function loadWordCloud() {
      const traits = [
      ["Leader", 30],
      ["Instructor", 15],
      ["Connector", 25],
      ["Smart", 15],
      ["Mature", 20],
      ["Impact-Driven", 40],
      ["Resilience", 30],
      ["Passionate", 20],
      ["Faithful", 30],
      ["Confident", 20]
      ["Innovative", 15],
      ["Questioner", 30],
      ["Insightful", 40],
      ["Visionary", 20],
      ["Emotionally Stable", 25],
      ];

      const canvas = document.getElementById("word-cloud");
      
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      WordCloud(canvas, {
        list: traits, // ä½¿ç”¨ç‰¹æ€§è¯è¯­åˆ—è¡¨
        gridSize: Math.round(16 * window.innerWidth / 1024), // ç½‘æ ¼å¤§å°ï¼Œéšå±å¹•å˜åŒ–è°ƒæ•´
        weightFactor: window.innerWidth / 400, // å­—ä½“å¤§å°æ¯”ä¾‹
        fontFamily: "Times, serif", // å­—ä½“
        color: function () {
          const colors = ["#1E88E5", "#F4511E", "#43A047", "#FB8C00", "#5E35B1"];
          return colors[Math.floor(Math.random() * colors.length)];
        },
        // backgroundColor: "#F0F4F8", // æŸ”å’ŒèƒŒæ™¯è‰²
        rotateRatio: 0., // å‡å°‘æ–‡å­—æ—‹è½¬
        shuffle: true, // éšæœºæ’åˆ—å•è¯
        shape: "circle", // åœ†å½¢å¸ƒå±€
        drawOutOfBound: false,
      });
    }
  </script>

  <!-- 3D word cloud will be initialized dynamically -->

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.0.6/wordcloud2.min.js"></script>
  <script src="https://www.goat1000.com/tagcanvas.min.js"></script>
</head>

<body>

<div style="background-image:linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)),url('./media/occupacy.jpg');background-size: cover; background-position: center;padding-bottom: 20px;">
  <nav class="navbar is-primary">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <strong id="navbar-title">Hey! Joshua!</strong>
        </a>
    </div>

    <div id="top-navbar" class="navbar-menu">
        <div class="navbar-end">
            <a class="navbar-item" href="#about" id="navbar-about">
                About Me
            </a>
            <a class="navbar-item" href="#news" id="navbar-news">
                News
            </a>
            <a class="navbar-item" href="#publications" id="navbar-publications">
                Publications
            </a>
            <a class="navbar-item" href="#projects" id="navbar-projects">
                Projects
            </a>
            <a class="navbar-item" href="#blogs" id="navbar-blogs">
                Blogs
            </a>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" id="navbar-language">
                Language
              </a>
              <div class="navbar-dropdown">
                <!-- è¯­è¨€æŒ‰é’®å°†åŠ¨æ€ç”Ÿæˆ -->
              </div>
            </div>
        </div>
    </div>
  </nav>
  <div class="container has-text-centered">
    <div style="display: flex; justify-content: space-between; align-items: center; height: 300px;">
      <div style="flex: 1;display: flex; justify-content: center; align-items: center;">
        <div class="card-container">
          <!-- å¡ç‰‡å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
      
          <!-- Arrow Buttons -->
          <button class="arrow-btn arrow-left" id="prev-btn">
            <i class="fas fa-arrow-left"></i>
          </button>
          <button class="arrow-btn arrow-right" id="next-btn">
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    
      <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
        <figure class="image is-128x128 is-inline-block" style="width: 200px; height: 200px; margin: 0;">
          <img class="is-rounded" src="./media/personal.jpg" alt="Avatar" style="width: 100%; height: 100%;">
        </figure>
      </div>
  
      <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
        <div id="canvas-container">
          <canvas id="word-cloud" width="400" height="300"></canvas>
          <ul id="tags">
            <!-- è¯äº‘æ ‡ç­¾å°†åŠ¨æ€ç”Ÿæˆ -->
          </ul>
        </div>
      </div>
    </div>
    <h1 class="title is-size-3-tablet is-size-4-mobile" style="font-family: Futura;" id="main-title">
      Dream Big, Work Hard, Stay Humble.
    </h1>
    <p class="subtitle is-size-4-tablet is-size-5-mobile" style="font-family: Brush Script MT;" id="main-subtitle">
      â€”â€”Be Versatile, Be Great.
    </p>
    <div class="icon-box">
      <a href="https://github.com/Phospheneser" target="_blank">
          <i class="fab fa-github"></i>
      </a>
      <a href="https://scholar.google.com/citations?user=TSUlagkAAAAJ&hl=zh-CN" target="_blank">
          <i class="fas fa-graduation-cap"></i>
      </a>
      <a href="https://x.com/PhospheneserXu" target="_blank">
          <i class="fab fa-twitter"></i>
      </a>
      <a href="mailto:zxu24@m.fudan.edu.cn">
          <i class="fas fa-envelope"></i>
      </a>
  </div>
  </div>
</div>


<section class="section" name="sec-intro">
  <div class="container is-max-desktop">
    <div id="about">
      <h1 class="title is-3" id="about-title">ğŸ„ About Me</h1>
    </div>
    <div>
      <p class="text-homepage-1" id="about-text1"></p>
      <p class="text-homepage-1" id="about-text2"></p>
    </div>
  </div>
  
</section>

<section class="section" name="sec-news">
  <div class="container is-max-desktop">
    <div id="news">
      <h1 class="title is-3" style="margin-bottom: 1ex;" id="news-title">ğŸ”¥ News</h1>
      <div>
        <!-- æ–°é—»å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>
</section>

<section class="section" name="sec-publications">
  <div class="container is-max-desktop">
    <div id="publications">
      <h1 class="title is-3" style="margin-bottom: 1ex;" id="publications-title">ğŸ“‘ Publications</h1>
      <div>
        <!-- å‡ºç‰ˆç‰©å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>
</section>

<section class="section" name="sec-projects">
  <div class="container is-max-desktop">
    <div id="projects">
      <h1 class="title is-3" id="projects-title">âš™ï¸ Projects</h1>
      <div>
        <!-- é¡¹ç›®å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
    <div id="academic-service">
      <h1 class="title is-3" style="margin-bottom: 1em;" id="academic-service-title">Academic Service</h1>
      <div>
        <!-- å­¦æœ¯æœåŠ¡å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>
</section>

<section class="blogs">
  <div class="container is-max-desktop">
    <div id="blogs">
      <h1 class="title is-3" style="margin-bottom: 1ex;" id="blogs-title">Blogs</h1>
      <div>
        <!-- åšå®¢å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>
</section>


<footer class="footer">
  <div class="container">
    <div class="columns is-centered">
      <div class="column">
        <div class="content has-text-centered">
          <p id="footer-text">
            Edit by Joshua@2025.9.27
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

</body>

<script>
let currentLang = localStorage.getItem('lang') || 'en';
let availableLanguages = ['en', 'zh', 'jp']; // ç›´æ¥å®šä¹‰å¯ç”¨è¯­è¨€åˆ—è¡¨

async function loadContent(lang = currentLang) {

  // åŠ è½½æ‰€æœ‰æ•°æ®æ–‡ä»¶
  const [webContentRes, projectsRes, publicationsRes, newsRes, blogsRes, academicServiceRes, cardsRes, wordcloudRes] = await Promise.all([
    fetch(`data/${lang}/web_content.json`),
    fetch(`data/${lang}/projects.json`),
    fetch(`data/${lang}/publications.json`),
    fetch(`data/${lang}/news.json`),
    fetch(`data/${lang}/blogs.json`),
    fetch(`data/${lang}/academic_service.json`),
    fetch(`data/${lang}/cards.json`),
    fetch(`data/${lang}/wordcloud.json`)
  ]);

  const webContent = await webContentRes.json();
  const projects = await projectsRes.json();
  const publications = await publicationsRes.json();
  const news = await newsRes.json();
  const blogs = await blogsRes.json();
  const academicService = await academicServiceRes.json();
  const cards = await cardsRes.json();
  const wordcloud = await wordcloudRes.json();

  const projectsList = projects.projects || [];
  const publicationsList = publications.publications || [];
  const newsList = news.news || [];
  const blogsList = blogs.blogs || [];
  const academicServiceList = academicService.academic_services || [];
  const cardsList = cards.cards || [];
  const wordcloudList = wordcloud.wordcloud || [];

  // æ›´æ–°å¯¼èˆªæ 
  updateElement('#navbar-title', webContent.navbar_title);
  updateElement('#navbar-about', webContent.navbar_about);
  updateElement('#navbar-news', webContent.navbar_news);
  updateElement('#navbar-publications', webContent.navbar_publications);
  updateElement('#navbar-projects', webContent.navbar_projects);
  updateElement('#navbar-blogs', webContent.navbar_blogs);
  updateElement('#navbar-language', webContent.language);

  // åŠ¨æ€ç”Ÿæˆè¯­è¨€åˆ‡æ¢æŒ‰é’®
  generateLanguageButtons(webContent);

  // æ›´æ–°æ ‡é¢˜å’Œå‰¯æ ‡é¢˜
  updateElement('#main-title', webContent.title);
  updateElement('#main-subtitle', webContent.subtitle);

  // æ›´æ–° About éƒ¨åˆ†
  updateElement('#about-title', webContent.about_title);
  updateElement('#about-text1', webContent.about_text1);
  updateElement('#about-text2', webContent.about_text2);

  // æ›´æ–°å…¶ä»–éƒ¨åˆ†æ ‡é¢˜
  updateElement('#news-title', webContent.news_title);
  updateElement('#publications-title', webContent.publications_title);
  updateElement('#projects-title', webContent.projects_title);
  updateElement('#academic-service-title', webContent.academic_service_title);
  updateElement('#blogs-title', webContent.blogs_title);

  // æ›´æ–°é¡µè„š
  updateElement('#footer-text', webContent.footer);

  // åŠ¨æ€ç”Ÿæˆæ–°é—»
  generateNews(newsList);

  // åŠ¨æ€ç”Ÿæˆå‡ºç‰ˆç‰©
  generatePublications(publicationsList);

  // åŠ¨æ€ç”Ÿæˆé¡¹ç›®
  generateProjects(projectsList);

  // åŠ¨æ€ç”Ÿæˆå­¦æœ¯æœåŠ¡
  generateAcademicService(academicServiceList);

  // åŠ¨æ€ç”Ÿæˆåšå®¢
  generateBlogs(blogsList);

  // åŠ¨æ€ç”Ÿæˆå¡ç‰‡
  generateCards(cardsList);

  // åˆå§‹åŒ–å¡ç‰‡åˆ‡æ¢åŠŸèƒ½
  initializeCardSlider();

  // åŠ¨æ€ç”Ÿæˆè¯äº‘
  generateWordCloud(wordcloudList);

  // ç¡®ä¿è¯äº‘æ­£ç¡®åˆå§‹åŒ–ï¼ˆé¦–æ¬¡åŠ è½½æˆ–è¯­è¨€åˆ‡æ¢ï¼‰
  setTimeout(() => {
    generateWordCloud(wordcloudList);
  }, 100);
}

function updateElement(selector, html) {
  const element = document.querySelector(selector);
  if (element) element.innerHTML = html;
}

function generateLanguageButtons(webContent) {
  const langDropdown = document.querySelector('#navbar-language').parentElement;
  const dropdown = langDropdown.querySelector('.navbar-dropdown');
  dropdown.innerHTML = '';
  availableLanguages.forEach(lang => {
    // ä»å½“å‰è¯­è¨€çš„ webContent ä¸­è·å–è¯­è¨€åç§°
    const langKeyMap = {
      'en': 'english',
      'zh': 'chinese',
      'jp': 'japanese'
    };
    const langKey = langKeyMap[lang];
    const langName = webContent[langKey] || lang;
    const button = document.createElement('a');
    button.className = 'navbar-item';
    button.onclick = () => switchLanguage(lang);
    button.innerHTML = langName;
    dropdown.appendChild(button);
  });
}

function generateNews(newsList) {
  console.log('Generating news with data:', newsList);
  const newsContainer = document.querySelector('#news');
  if (!newsContainer) {
    console.error('News container not found');
    return;
  }

  // ç›´æ¥é€‰æ‹© #news çš„ç¬¬äºŒä¸ªå­å…ƒç´ ï¼ˆå†…å®¹å®¹å™¨ï¼‰
  const newsDiv = newsContainer.children[1];
  if (!newsDiv) {
    console.error('News content div not found');
    console.log('News container children:', newsContainer.children);
    return;
  }
  console.log('Found news div:', newsDiv);
  newsDiv.innerHTML = '';
  newsList.forEach(item => {
    const div = document.createElement('div');
    div.style.cssText = 'display: flex; justify-content: flex-start; align-items: center; margin-bottom: 15px;';
    div.innerHTML = `
      <span style="font-weight: bold; margin-right: 50px;">${item.date}</span>
      <span style="font-family: Georgia">${item.content}</span>
    `;
    newsDiv.appendChild(div);
  });
  console.log('News generation completed');
}

function generatePublications(publicationsList) {
  console.log('Generating publications with data:', publicationsList);
  const publicationsSection = document.querySelector('#publications');
  if (!publicationsSection) {
    console.error('Publications section not found');
    return;
  }

  // ç›´æ¥é€‰æ‹© #publications çš„ç¬¬äºŒä¸ªå­å…ƒç´ ï¼ˆå†…å®¹å®¹å™¨ï¼‰
  const contentDiv = publicationsSection.children[1];
  if (!contentDiv) {
    console.error('Publications content div not found');
    console.log('Publications container children:', publicationsSection.children);
    return;
  }
  console.log('Found publications div:', contentDiv);

  // ç§»é™¤ç°æœ‰ paper-container
  const existingContainers = contentDiv.querySelectorAll('.paper-container');
  existingContainers.forEach(c => c.remove());

  publicationsList.forEach(pub => {
    const paperContainer = document.createElement('div');
    paperContainer.className = 'paper-container';
    paperContainer.innerHTML = `
      <img src="${pub.image}" alt="Overview" class="paper-image">
      <div class="paper-content">
        <h2 class="paper-title">${pub.title}</h2>
        ${pub.conference ? `<p class="paper-conf">${pub.conference}</p>` : ''}
        <p class="paper-authors">${pub.authors}</p>
        <p class="paper-description">${pub.description}</p>
        <p>
          ${pub.links ? pub.links.map(link => `<a href="${link.url}" target="_blank" class="paper-link">[${link.type}]</a>`).join(' ') : ''}
        </p>
      </div>
    `;
    contentDiv.appendChild(paperContainer);
  });
  console.log('Publications generation completed');
}

function generateProjects(projectsList) {
  console.log('Generating projects with data:', projectsList);
  const projectsSection = document.querySelector('#projects');
  if (!projectsSection) {
    console.error('Projects section not found');
    return;
  }

  // ç›´æ¥é€‰æ‹© #projects çš„ç¬¬äºŒä¸ªå­å…ƒç´ ï¼ˆå†…å®¹å®¹å™¨ï¼‰
  const contentDiv = projectsSection.children[1];
  if (!contentDiv) {
    console.error('Projects content div not found');
    console.log('Projects container children:', projectsSection.children);
    return;
  }
  console.log('Found projects div:', contentDiv);

  // ç§»é™¤ç°æœ‰ paper-container
  const existingContainers = contentDiv.querySelectorAll('.paper-container');
  existingContainers.forEach(c => c.remove());

  projectsList.forEach(proj => {
    const paperContainer = document.createElement('div');
    paperContainer.className = 'paper-container';
    const imageHtml = proj.image ? `<img src="${proj.image}" alt="Overview" class="paper-image">` : '<div class="paper-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; height: 150px;">No Image</div>';
    paperContainer.innerHTML = `
      ${imageHtml}
      <div class="paper-content">
        <h2 class="paper-title" style="display: flex; justify-content: space-between; align-items: center;">
          ${proj.title}
          <span style="margin-left: auto; font-size: 16px;">${proj.date}</span>
        </h2>
        <p class="paper-authors">${proj.authors}</p>
        <p class="paper-description">${proj.description}</p>
        ${proj.links ? `<p>${proj.links.map(link => `<a href="${link.url}" target="_blank" class="paper-link">[${link.type}]</a>`).join(' ')}</p>` : ''}
      </div>
    `;
    contentDiv.appendChild(paperContainer);
  });
  console.log('Projects generation completed');
}

function generateBlogs(blogsList) {
  console.log('Generating blogs with data:', blogsList);
  const blogsSection = document.querySelector('#blogs');
  if (!blogsSection) {
    console.error('Blogs section not found');
    return;
  }

  // ç›´æ¥é€‰æ‹© #blogs çš„ç¬¬äºŒä¸ªå­å…ƒç´ ï¼ˆå†…å®¹å®¹å™¨ï¼‰
  const contentDiv = blogsSection.children[1];
  if (!contentDiv) {
    console.error('Blogs content div not found');
    console.log('Blogs container children:', blogsSection.children);
    return;
  }
  console.log('Found blogs div:', contentDiv);

  // æ¸…ç©ºç°æœ‰å†…å®¹
  contentDiv.innerHTML = '';

  // å¯ä»¥åœ¨è¿™é‡Œç”Ÿæˆåšå®¢å†…å®¹ï¼Œå¦‚æœæœ‰çš„è¯
  // ç›®å‰ blogs.json æ˜¯ç©ºçš„
  if (blogsList.length === 0) {
    contentDiv.innerHTML = '<p>No blog posts yet.</p>';
  } else {
    blogsList.forEach(blog => {
      const blogDiv = document.createElement('div');
      blogDiv.innerHTML = `
        <h3>${blog.title}</h3>
        <p>${blog.date}</p>
        <p>${blog.content}</p>
      `;
      contentDiv.appendChild(blogDiv);
    });
  }
  console.log('Blogs generation completed');
}

function generateAcademicService(academicServiceList) {
  console.log('Generating academic service with data:', academicServiceList);
  const academicServiceSection = document.querySelector('#academic-service');
  if (!academicServiceSection) {
    console.error('Academic service section not found');
    return;
  }

  // ç›´æ¥é€‰æ‹© #academic-service çš„ç¬¬äºŒä¸ªå­å…ƒç´ ï¼ˆå†…å®¹å®¹å™¨ï¼‰
  const contentDiv = academicServiceSection.children[1];
  if (!contentDiv) {
    console.error('Academic service content div not found');
    console.log('Academic service container children:', academicServiceSection.children);
    return;
  }
  console.log('Found academic service div:', contentDiv);

  // æ¸…ç©ºç°æœ‰å†…å®¹
  contentDiv.innerHTML = '';

  if (academicServiceList.length === 0) {
    contentDiv.innerHTML = '<p>No academic service records yet.</p>';
  } else {
    academicServiceList.forEach(service => {
      const serviceDiv = document.createElement('div');
      serviceDiv.style.cssText = 'display: flex; justify-content: flex-start; align-items: center; margin-bottom: 15px;';
      serviceDiv.innerHTML = `
        <span style="font-weight: bold; margin-right: 50px;">${service.type}</span>
        <span>${service.description}</span>
      `;
      contentDiv.appendChild(serviceDiv);
    });
  }
  console.log('Academic service generation completed');
}

function generateCards(cardsList) {
  console.log('Generating cards with data:', cardsList);
  const cardContainer = document.querySelector('.card-container');
  if (!cardContainer) {
    console.error('Card container not found');
    return;
  }

  // åªåˆ é™¤ç°æœ‰çš„å¡ç‰‡å…ƒç´ ï¼Œä¿ç•™æŒ‰é’®
  const existingCards = cardContainer.querySelectorAll('.card');
  existingCards.forEach(card => card.remove());

  if (cardsList.length === 0) {
    console.log('No cards data available');
    return;
  }

  // åªæ˜¾ç¤ºå‰5å¼ å¡ç‰‡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
  const displayCards = cardsList.slice(0, 5);

  displayCards.forEach(card => {
    const cardDiv = document.createElement('div');
    cardDiv.className = 'card';
    cardDiv.innerHTML = `
      <div class="card-title">${card.title}</div>
      <div class="card-description">${card.description}</div>
    `;
    cardContainer.appendChild(cardDiv);
  });

  console.log('Cards generation completed');
}

function generateWordCloud(wordcloudList) {
  console.log('Generating word cloud with data:', wordcloudList);
  const tagsContainer = document.querySelector('#tags');
  if (!tagsContainer) {
    console.error('Word cloud tags container not found');
    return;
  }

  // æ¸…ç©ºç°æœ‰æ ‡ç­¾
  tagsContainer.innerHTML = '';

  if (wordcloudList.length === 0) {
    console.log('No word cloud data available');
    return;
  }

  wordcloudList.forEach(item => {
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = '#';
    if (item.title) {
      a.title = item.title;
    }
    a.textContent = item.text;
    li.appendChild(a);
    tagsContainer.appendChild(li);
  });

  // é‡æ–°åˆå§‹åŒ–TagCanvasè¯äº‘
  try {
    if (typeof TagCanvas !== 'undefined') {
      TagCanvas.Start('word-cloud', 'tags', {
        textColour: '#FFFFFF',
        outlineColour: 'rgba(255, 255, 255, 0.5)',
        reverse: true,
        depth: 0.8,
        maxSpeed: 0.01,
        textFont: 'Papyrus, Arial, sans-serif',
        textHeight: 20,
        shuffleTags: true,
        initial: [0.3, 0.3],
        decel: 0.98,
        dragControl: true,
        weight: true,
        shape: 'spiral',
        tooltip: true
      });

      // æ·»åŠ è‡ªå®šä¹‰çš„è‡ªåŠ¨é‡æ–°å¼€å§‹åŠŸèƒ½
      setupWordCloudAutoRestart();
    }
  } catch (e) {
    console.error('TagCanvas re-initialization error:', e);
  }

  console.log('Word cloud generation completed');
}

// è®¾ç½®è¯äº‘è‡ªåŠ¨é‡æ–°å¼€å§‹åŠŸèƒ½
function setupWordCloudAutoRestart() {
  const canvas = document.getElementById('word-cloud');
  if (!canvas) return;

  let restartTimer = null;
  let isUserInteracting = false;
  let lastInteractionTime = Date.now();
  let dragStartTime = 0;

  // ç›‘å¬é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
  canvas.addEventListener('mousedown', function(e) {
    isUserInteracting = true;
    dragStartTime = Date.now();
    lastInteractionTime = Date.now();
    console.log('Word cloud interaction started');

    // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
    if (restartTimer) {
      clearTimeout(restartTimer);
    }
  });

  // ç›‘å¬documentçš„é¼ æ ‡é‡Šæ”¾äº‹ä»¶ï¼Œç¡®ä¿å³ä½¿é¼ æ ‡åœ¨åŒºåŸŸå¤–é‡Šæ”¾ä¹Ÿèƒ½æ£€æµ‹åˆ°
  document.addEventListener('mouseup', function(e) {
    if (isUserInteracting) {
      isUserInteracting = false;
      lastInteractionTime = Date.now();
      const interactionDuration = Date.now() - dragStartTime;
      console.log('Word cloud interaction ended, duration:', interactionDuration + 'ms');

      // å¦‚æœäº¤äº’æ—¶é—´å¾ˆçŸ­ï¼ˆåªæ˜¯ç‚¹å‡»ï¼‰ï¼Œç«‹å³é‡å¯
      if (interactionDuration < 100) {
        console.log('Short click detected, restarting immediately');
        setTimeout(() => startWordCloudRotation(), 100);
        return;
      }

      // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
      if (restartTimer) {
        clearTimeout(restartTimer);
      }

      // 5ç§’åé‡æ–°å¼€å§‹è½¬åŠ¨
      restartTimer = setTimeout(function() {
        const timeSinceLastInteraction = Date.now() - lastInteractionTime;
        if (timeSinceLastInteraction >= 5000 && !isUserInteracting) {
          console.log('Word cloud restarting after 5 seconds of inactivity');
          startWordCloudRotation();
        }
      }, 5000);
    }
  });

  // ç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶
  canvas.addEventListener('mousemove', function(e) {
    if (isUserInteracting) {
      lastInteractionTime = Date.now();
      // æ¸…é™¤å®šæ—¶å™¨ï¼Œå› ä¸ºç”¨æˆ·æ­£åœ¨äº¤äº’
      if (restartTimer) {
        clearTimeout(restartTimer);
        restartTimer = setTimeout(function() {
          const timeSinceLastInteraction = Date.now() - lastInteractionTime;
          if (timeSinceLastInteraction >= 5000 && !isUserInteracting) {
            console.log('Word cloud restarting after 5 seconds of inactivity');
            startWordCloudRotation();
          }
        }, 5000);
      }
    }
  });

  // ç›‘å¬é¼ æ ‡ç¦»å¼€äº‹ä»¶
  canvas.addEventListener('mouseleave', function() {
    // é¼ æ ‡ç¦»å¼€æ—¶ä¸æ”¹å˜isUserInteractingçŠ¶æ€ï¼Œè®©documentçš„mouseupäº‹ä»¶å¤„ç†
    console.log('Mouse left word cloud area');
  });

  // ç›‘å¬é¼ æ ‡è¿›å…¥äº‹ä»¶
  canvas.addEventListener('mouseenter', function() {
    // å¦‚æœé¼ æ ‡è¿›å…¥æ—¶è¿˜åœ¨äº¤äº’çŠ¶æ€ï¼ˆè¯´æ˜é¼ æ ‡åœ¨åŒºåŸŸå¤–é‡Šæ”¾äº†ï¼‰
    if (!isUserInteracting && Date.now() - lastInteractionTime < 5000) {
      isUserInteracting = true;
      lastInteractionTime = Date.now();

      // é¼ æ ‡é‡æ–°è¿›å…¥æ—¶ï¼Œæ¸…é™¤å®šæ—¶å™¨ï¼Œå› ä¸ºç”¨æˆ·å›æ¥äº†
      if (restartTimer) {
        clearTimeout(restartTimer);
        restartTimer = null;
        console.log('Mouse entered word cloud area, timer cleared');
      } else {
        console.log('Mouse entered word cloud area');
      }
    }
  });
}

// å¯åŠ¨è¯äº‘è½¬åŠ¨ï¼ˆé€æ­¥åŠ é€Ÿï¼‰
function startWordCloudRotation() {
  if (typeof TagCanvas === 'undefined') return;

  try {
    const canvas = document.getElementById('word-cloud');
    if (canvas) {
      // å°è¯•é‡æ–°å¼€å§‹TagCanvasåŠ¨ç”»
      if (canvas.tc) {
        // é‡æ–°è®¾ç½®åŠ¨ç”»çŠ¶æ€
        canvas.tc.animating = true;
        canvas.tc.active = true;

        // ç»™æ‰€æœ‰æ ‡ç­¾æ·»åŠ éšæœºé€Ÿåº¦
        if (canvas.tc.taglist && canvas.tc.taglist.length > 0) {
          canvas.tc.taglist.forEach(function(tag) {
            tag.vx = (Math.random() - 0.5) * 0.02;
            tag.vy = (Math.random() - 0.5) * 0.02;
            tag.va = (Math.random() - 0.5) * 0.02;
          });
        }

        // å¼ºåˆ¶é‡ç»˜
        if (canvas.tc.Draw) {
          canvas.tc.Draw();
        }
        console.log('Word cloud rotation restarted with velocity reset');
      } else {
        // å¦‚æœtcå¯¹è±¡ä¸å­˜åœ¨ï¼Œé‡æ–°åˆå§‹åŒ–
        TagCanvas.Start('word-cloud', 'tags', {
          textColour: '#FFFFFF',
          outlineColour: 'rgba(255, 255, 255, 0.5)',
          reverse: true,
          depth: 0.8,
          maxSpeed: 0.01,
          textFont: 'Papyrus, Arial, sans-serif',
          textHeight: 20,
          shuffleTags: true,
          initial: [0.3, 0.3],
          decel: 0.98,
          dragControl: true,
          weight: true,
          shape: 'spiral',
          tooltip: true
        });
        console.log('Word cloud re-initialized');
      }
    }
  } catch (e) {
    console.error('Error restarting word cloud rotation:', e);
  }
}

function switchLanguage(lang) {
  localStorage.setItem('lang', lang);
  loadContent(lang);
}

// åˆå§‹åŒ–å¡ç‰‡åˆ‡æ¢åŠŸèƒ½
function initializeCardSlider() {
  const cards = document.querySelectorAll('.card');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  let currentIndex = Math.floor(Math.random() * cards.length);

  // Function to show the current card
  function showCard(index) {
    cards.forEach((card, i) => {
      card.classList.remove('active');
      if (i === index) {
        card.classList.add('active');
      }
    });
  }

  // Handle Previous Button
  if (prevBtn) {
    prevBtn.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + cards.length) % cards.length;
      showCard(currentIndex);
    });
  }

  // Handle Next Button
  if (nextBtn) {
    nextBtn.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % cards.length;
      showCard(currentIndex);
    });
  }

  // Optionally: Auto switch cards every 5 seconds
  setInterval(() => {
    currentIndex = (currentIndex + 1) % cards.length;
    showCard(currentIndex);
  }, 5000);

  // æ˜¾ç¤ºç¬¬ä¸€å¼ å¡ç‰‡
  if (cards.length > 0) {
    showCard(currentIndex);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  loadContent();
});
</script>
</html>