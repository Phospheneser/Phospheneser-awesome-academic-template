<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multipage - Academic Template</title>

    <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./static/css/bulma.min.css">
    <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
    <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
    <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
    <link rel="stylesheet" href="./static/css/index.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script defer src="./static/js/fontawesome.all.min.js"></script>
    <script src="./static/js/bulma-carousel.min.js"></script>
    <script src="./static/js/bulma-slider.min.js"></script>
    <script src="./static/js/index.js"></script>
    <script src="./static/js/templates.js"></script>
    <script src="./static/js/plugins.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.0.6/wordcloud2.min.js"></script>
    <script src="https://www.goat1000.com/tagcanvas.min.js"></script>

    <style>
        /* 干掉 Bulma 默认箭头 */
        .navbar.is-primary .navbar-end .navbar-link::after,
        .navbar.is-primary .navbar-start .navbar-link::after {
            content: none !important;
            border: none !important;
        }
    </style>
</head>

<body>

    <div id="background-container"
        style="background-image:linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)),url('./media/occupacy.jpg');background-size: cover; background-position: center;background-attachment: fixed;padding-top: 52px; padding-bottom: 20px; margin-top: -52px; width: 100vw; position: relative; min-height: 100vh;">
        <nav class="navbar is-primary">
            <div class="navbar-brand">
                <a class="navbar-item" href="#" id="navbar-home">
                    <strong id="navbar-title">Home</strong>
                </a>

                <a class="navbar-item dark-mode-toggle-mobile" href="#" id="dark-mode-toggle-mobile"
                    title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </a>

                <a class="navbar-item layout-mode-toggle" href="#" id="layout-mode-toggle"
                    title="Switch to Single-page Mode">
                    <i class="fas fa-file-alt"></i>
                </a>

                <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="top-navbar">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>

            <div id="top-navbar" class="navbar-menu">
                <div class="navbar-end">
                    <div class="navbar-item has-dropdown" id="language-dropdown">
                        <a class="navbar-link" id="navbar-language"><span id="lang-label">Language</span><i
                                class="fas fa-chevron-left lang-arrow"></i></a>
                        <div class="navbar-dropdown" id="language-dropdown-menu"></div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container is-max-desktop" id="content-root" style="min-height: calc(100vh - 120px);">
            <!-- 动态内容容器 -->
        </div>

        <footer class="footer" style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000;">
            <div class="container">
                <div class="columns is-centered">
                    <div class="column">
                        <div class="content has-text-centered">
                            <p id="footer-text">Edit by Joshua@2025.9.27</p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <button id="back-to-top" class="back-to-top" title="返回顶部">
            <i class="fas fa-chevron-up"></i>
        </button>
    </div>

</body>

<script>
    let currentLang = localStorage.getItem('lang') || 'en';
    let availableLanguages = ['en', 'zh', 'jp'];
    let metaConfig = null;

    async function loadMeta() {
        try {
            const res = await fetch(`data/meta.json`);
            metaConfig = await res.json();
            if (Array.isArray(metaConfig.availableLanguages)) {
                availableLanguages = metaConfig.availableLanguages;
            }
        } catch (e) { console.error('Failed to load meta.json', e); }
    }

    function generateSocials(socials) {
        const box = document.querySelector('.icon-box');
        if (!box) return;
        box.innerHTML = '';
        (socials || []).forEach(s => {
            const a = document.createElement('a');
            a.href = s.url || '#';
            a.target = '_blank';
            const i = document.createElement('i');
            i.className = s.icon || 'fas fa-link';
            a.appendChild(i);
            box.appendChild(a);
        });
    }

    function getPageKey() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('page') || 'home';
    }

    async function loadWebContent(lang = currentLang) {
        const res = await fetch(`data/${lang}/web_content.json`);
        return await res.json();
    }

    function updateElement(selector, html) {
        if (html === undefined || html === null) return;
        const element = document.querySelector(selector);
        if (element) element.innerHTML = html;
    }

    function renderTextList(selector, texts) {
        const container = document.querySelector(selector);
        if (!container) return;
        container.innerHTML = '';
        if (!Array.isArray(texts)) return;
        texts.forEach((text, idx) => {
            const p = document.createElement('p');
            p.className = 'text-homepage-1';
            p.innerHTML = text;
            p.dataset.index = idx;
            container.appendChild(p);
        });
    }

    async function loadSectionDataMap(lang) {
        const map = {};
        if (!metaConfig || !Array.isArray(metaConfig.sections)) return map;
        const tasks = metaConfig.sections.map(async (section) => {
            if (!section.enabled) return;
            const source = section.dataSource || section.id;
            try {
                const res = await fetch(`data/${lang}/${source}.json`);
                if (!res.ok) return;
                const data = await res.json();
                map[section.id] = data;
            } catch (err) {
                console.error(`Failed to load section data for ${section.id}`, err);
            }
        });
        await Promise.all(tasks);
        return map;
    }

    function applyBackground(pageId) {
        const container = document.getElementById('background-container');
        if (!container || !metaConfig) return;

        const darkMode = document.body.classList.contains('dark-mode');
        const backgrounds = metaConfig.backgrounds || {};
        const section = metaConfig.sections ? metaConfig.sections.find(s => s.id === pageId) : null;
        let key = (section && section.background) || (pageId === 'home' ? (backgrounds.home ? 'home' : 'default') : null);
        if (!key || !backgrounds[key]) key = 'default';
        const defaultBg = backgrounds.default || {};
        const bgConfig = backgrounds[key] || {};
        const lightImage = bgConfig.light || defaultBg.light || './media/occupacy.jpg';
        const darkImage = bgConfig.dark || defaultBg.dark || '';

        let background;
        if (darkMode) {
            if (darkImage) {
                background = `linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.35)),url('${darkImage}')`;
            } else {
                background = `linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),url('${lightImage}')`;
            }
        } else {
            background = `linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)),url('${lightImage}')`;
        }

        container.style.backgroundImage = background;
    }

    async function loadHomeWidgets() {
        try {
            const [cardsRes, wordcloudRes] = await Promise.all([
                fetch(`data/${currentLang}/cards.json`),
                fetch(`data/${currentLang}/wordcloud.json`)
            ]);

            const cardsData = cardsRes.ok ? await cardsRes.json() : { cards: [] };
            const wordcloudData = wordcloudRes.ok ? await wordcloudRes.json() : { wordcloud: [] };

            generateCards(cardsData.cards || []);
            generateWordCloud(wordcloudData.wordcloud || []);
            initializeCardSlider();
        } catch (err) {
            console.error('Failed to load home widgets:', err);
        }
    }

    function generateCards(cardsList) {
        const cardContainer = document.querySelector('.card-container');
        if (!cardContainer) return;

        cardContainer.querySelectorAll('.card').forEach(card => card.remove());

        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        if (!Array.isArray(cardsList) || cardsList.length === 0) {
            if (prevBtn) prevBtn.style.display = 'none';
            if (nextBtn) nextBtn.style.display = 'none';
            return;
        }

        if (prevBtn) prevBtn.style.display = '';
        if (nextBtn) nextBtn.style.display = '';

        const insertBeforeNode = nextBtn || null;
        cardsList.slice(0, 5).forEach(card => {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            cardDiv.innerHTML = `
      <div class="card-title">${card.title || ''}</div>
      <div class="card-description">${card.description || ''}</div>`;
            cardContainer.insertBefore(cardDiv, insertBeforeNode);
        });
    }

    function initializeCardSlider() {
        const cardContainer = document.querySelector('.card-container');
        if (!cardContainer) return;

        const cards = Array.from(cardContainer.querySelectorAll('.card'));
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        if (!cards.length) {
            if (prevBtn) prevBtn.style.display = 'none';
            if (nextBtn) nextBtn.style.display = 'none';
            return;
        }

        let currentIndex = Math.floor(Math.random() * cards.length);
        if (!Number.isFinite(currentIndex)) currentIndex = 0;

        function showCard(index) {
            cards.forEach((card, i) => {
                if (i === index) card.classList.add('active'); else card.classList.remove('active');
            });
        }

        const showPrev = () => {
            currentIndex = (currentIndex - 1 + cards.length) % cards.length;
            showCard(currentIndex);
        };

        const showNext = () => {
            currentIndex = (currentIndex + 1) % cards.length;
            showCard(currentIndex);
        };

        if (prevBtn) {
            prevBtn.style.display = '';
            prevBtn.onclick = showPrev;
        }

        if (nextBtn) {
            nextBtn.style.display = '';
            nextBtn.onclick = showNext;
        }

        if (window.__cardSliderTimer) {
            clearInterval(window.__cardSliderTimer);
        }
        window.__cardSliderTimer = setInterval(showNext, 5000);

        showCard(currentIndex);
    }

    function generateWordCloud(wordcloudList) {
        const tagsContainer = document.querySelector('#tags');
        const canvas = document.getElementById('word-cloud');
        if (!tagsContainer || !canvas) return;

        tagsContainer.innerHTML = '';

        if (!Array.isArray(wordcloudList) || wordcloudList.length === 0) {
            canvas.style.display = 'none';
            return;
        }

        canvas.style.display = '';

        wordcloudList.forEach(item => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#';
            if (item && item.title) a.title = item.title;
            a.textContent = item && item.text ? item.text : '';
            li.appendChild(a);
            tagsContainer.appendChild(li);
        });

        try {
            if (typeof TagCanvas !== 'undefined') {
                if (typeof TagCanvas.Delete === 'function') {
                    try { TagCanvas.Delete('word-cloud'); } catch (e) { /* ignore */ }
                }
                TagCanvas.Start('word-cloud', 'tags', {
                    textColour: '#FFFFFF',
                    outlineColour: 'rgba(255, 255, 255, 0.5)',
                    reverse: true,
                    depth: 0.8,
                    maxSpeed: 0.01,
                    textFont: 'Papyrus, Arial, sans-serif',
                    textHeight: 20,
                    shuffleTags: true,
                    initial: [0.3, 0.3],
                    decel: 0.98,
                    dragControl: true,
                    weight: true,
                    shape: 'spiral'
                });
            }
        } catch (err) {
            console.error('Failed to initialize word cloud:', err);
        }
    }

    function generateLanguageButtons(webContent) {
        const langDropdown = document.querySelector('#language-dropdown');
        const wasOpen = langDropdown && langDropdown.classList.contains('is-active');
        const dropdown = document.querySelector('#language-dropdown-menu');
        dropdown.innerHTML = '';
        availableLanguages.forEach(lang => {
            const langName = (metaConfig && metaConfig.languageLabels && metaConfig.languageLabels[lang]) || lang;
            const button = document.createElement('a');
            button.className = 'navbar-item';
            button.onclick = (e) => { e.stopPropagation(); switchLanguage(lang); };
            button.innerHTML = langName;
            dropdown.appendChild(button);
        });
        // 恢复原先展开状态（避免PC端切换语言后收起）
        if (langDropdown && wasOpen) {
            langDropdown.classList.add('is-active');
        }
    }

    function switchLanguage(lang) {
        localStorage.setItem('lang', lang);
        currentLang = lang;
        const dropdown = document.querySelector('#language-dropdown');
        const wasOpen = dropdown && dropdown.classList.contains('is-active');
        renderPage().then(() => {
            const dd = document.querySelector('#language-dropdown');
            if (dd && wasOpen) dd.classList.add('is-active');
            applyBackground(getPageKey());
        });
    }

    function goTo(page) {
        const url = new URL(window.location.href);
        url.searchParams.set('page', page);
        window.history.pushState({}, '', url.toString());
        renderPage().then(() => applyBackground(getPageKey()));
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function wireNavLinks() {
        const links = document.querySelectorAll('.navbar-item[href^="?page="]');
        links.forEach(a => {
            a.addEventListener('click', (e) => {
                e.preventDefault();
                const href = a.getAttribute('href');
                const m = /[?&]page=([^&#]+)/.exec(href);
                if (m && m[1]) goTo(m[1]);
            });
        });
    }

    function generateNavFromMeta(sectionDataMap) {
        if (!metaConfig || !Array.isArray(metaConfig.sections)) return;
        const navbarEnd = document.querySelector('.navbar-end');
        if (!navbarEnd) return;
        const items = Array.from(navbarEnd.querySelectorAll('.navbar-item'));
        items.forEach(el => { if (!el.closest('#language-dropdown')) el.remove(); });
        metaConfig.sections.forEach(sec => {
            if (!sec.enabled) return;
            const a = document.createElement('a');
            a.className = 'navbar-item';
            a.id = `navbar-${sec.id}`;
            a.href = `?page=${sec.id}`;
            const label = (sectionDataMap && sectionDataMap[sec.id] && sectionDataMap[sec.id].nav_label) ? sectionDataMap[sec.id].nav_label : sec.id;
            a.innerHTML = label;
            navbarEnd.insertBefore(a, document.getElementById('language-dropdown'));
        });
        wireNavLinks();
    }

    async function renderPage() {
        await loadMeta();
        currentLang = localStorage.getItem('lang') || currentLang || 'en';
        const page = getPageKey();

        const [webContent, sectionDataMap] = await Promise.all([
            loadWebContent(currentLang),
            loadSectionDataMap(currentLang)
        ]);

        generateNavFromMeta(sectionDataMap);
        updateElement('#navbar-title', webContent.navbar_title);
        updateElement('#navbar-home', webContent.navbar_home);
        document.getElementById('lang-label').textContent = webContent.language;
        updateElement('#footer-text', webContent.footer);
        generateLanguageButtons(webContent);

        const root = document.getElementById('content-root');
        root.innerHTML = '';

        if (page === 'home') {
            const container = document.createElement('div');
            container.className = 'container has-text-centered';
            container.innerHTML = `
        <div class="mp-home-hero">
          <div class="mp-home-cards">
            <div class="card-container">
              <button class="arrow-btn arrow-left" id="prev-btn">
                <i class="fas fa-arrow-left"></i>
              </button>
              <button class="arrow-btn arrow-right" id="next-btn">
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <div class="mp-home-avatar">
            <figure class="image is-128x128 is-inline-block">
              <img class="is-rounded" src="./media/personal.jpg" alt="Avatar" style="width: 100%; height: 100%;">
            </figure>
          </div>

          <div class="mp-home-cloud">
            <div id="canvas-container">
              <canvas id="word-cloud" width="400" height="300"></canvas>
              <ul id="tags"></ul>
            </div>
          </div>
        </div>
        <div class="mp-home-meta">
          <h1 class="title is-size-3-tablet is-size-4-mobile" style="font-family: Futura;" id="main-title"></h1>
          <p class="subtitle is-size-4-tablet is-size-5-mobile" style="font-family: Brush Script MT;" id="main-subtitle"></p>
          <div class="icon-box">
            <a href="https://github.com/Phospheneser" target="_blank"><i class="fab fa-github"></i></a>
            <a href="https://scholar.google.com/citations?user=TSUlagkAAAAJ&hl=zh-CN" target="_blank"><i class="fas fa-graduation-cap"></i></a>
            <a href="https://x.com/PhospheneserXu" target="_blank"><i class="fab fa-twitter"></i></a>
            <a href="mailto:zxu24@m.fudan.edu.cn"><i class="fas fa-envelope"></i></a>
          </div>
        </div>`;
            root.appendChild(container);
            updateElement('#main-title', webContent.title);
            updateElement('#main-subtitle', webContent.subtitle);
            if (metaConfig && metaConfig.home && metaConfig.home.avatar) {
                const avatar = container.querySelector('img.is-rounded');
                if (avatar) avatar.src = metaConfig.home.avatar;
            }
            if (metaConfig && Array.isArray(metaConfig.socials)) {
                generateSocials(metaConfig.socials);
            }
            await loadHomeWidgets();
            applyBackground('home');
            return;
        }

        if (page === 'about') {
            const aboutData = sectionDataMap['about'] || {};
            const container = document.createElement('div');
            container.innerHTML = `
        <section class="section" name="sec-intro">
          <div id="about">
            <h1 class="title is-3" id="about-title" style="margin-top: 60px;">🎄 About Me</h1>
          </div>
          <div id="about-texts" class="about-texts"></div>
        </section>`;
            root.appendChild(container);
            updateElement('#about-title', aboutData.title || 'About');
            renderTextList('#about-texts', aboutData.texts || aboutData.paragraphs || []);
            applyBackground('about');
            return;
        }

        const section = metaConfig.sections.find(s => s.id === page);
        if (!section || !section.multiPage || !section.multiPage.enabled) return;
        const data = sectionDataMap[page] || {};
        const multiPageConfig = section.multiPage;
        let listData = [];
        if (section.dataSource && Array.isArray(data[section.dataSource])) {
            listData = data[section.dataSource];
        } else if (Array.isArray(data.items)) {
            listData = data.items;
        }

        const container = document.createElement('div');
        const sectionClass = page === 'blogs' ? 'blogs' : 'section';
        container.innerHTML = `
        <section class="${sectionClass}" name="sec-${page}">
          <div id="${page}" class="mp-section">
            <h1 class="title is-3" style="margin-bottom: 1ex; margin-top: 60px;" id="${page}-title"></h1>
            <div class="mp-controls" id="${page}-controls"></div>
            <div class="mp-list" id="${page}-content"></div>
          </div>
        </section>`;
        root.appendChild(container);

        const sectionRoot = container.querySelector(`#${page}`);
        const contentDiv = sectionRoot.querySelector('.mp-list');
        updateElement(`#${page}-title`, data.title || page);
        if (!contentDiv) {
            console.warn(`Missing content container for section ${page}`);
            return;
        }

        if (window.PluginRegistry && multiPageConfig.plugins) {
            window.PluginRegistry.applyPlugins({
                id: page,
                plugins: multiPageConfig.plugins
            }, sectionRoot, listData, data);
        }

        drawList(listData, section, contentDiv);
        applyBackground(page);
    }

    function drawList(list, section, contentDiv) {
        if (!contentDiv) return;
        contentDiv.innerHTML = '';
        const type = section.itemType;
        const templateName = (metaConfig && metaConfig.itemTypes && metaConfig.itemTypes[type] && metaConfig.itemTypes[type].template) || (type === 'news' ? 'list-inline' : 'paper-card');
        const renderer = (window.TemplateRegistry && window.TemplateRegistry.get(templateName));
        if (renderer) {
            renderer(list, section, contentDiv);
        }
    }

    function initializeLanguageDropdown() {
        const languageLink = document.querySelector('#navbar-language');
        const languageDropdown = document.querySelector('#language-dropdown');
        if (languageLink && languageDropdown) {
            // 初始保持收起
            languageDropdown.classList.remove('is-active');

            languageLink.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const willOpen = !languageDropdown.classList.contains('is-active');
                if (willOpen) {
                    languageDropdown.classList.remove('is-closing');
                    languageDropdown.classList.add('is-active');
                } else {
                    languageDropdown.classList.add('is-closing');
                    setTimeout(() => {
                        languageDropdown.classList.remove('is-active');
                        languageDropdown.classList.remove('is-closing');
                    }, 350);
                }
            });
            document.addEventListener('click', (e) => {
                if (!languageDropdown.contains(e.target) && languageDropdown.classList.contains('is-active')) {
                    languageDropdown.classList.add('is-closing');
                    setTimeout(() => {
                        languageDropdown.classList.remove('is-active');
                        languageDropdown.classList.remove('is-closing');
                    }, 350);
                }
            });
        }
    }

    function initializeLayoutMode() {
        const layoutModeToggle = document.getElementById('layout-mode-toggle');
        if (layoutModeToggle) {
            layoutModeToggle.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.setItem('layoutMode', 'single');
                window.location.href = 'index.html?scroll=top';
            });
        }
    }

    function initializeDarkMode() {
        const darkModeToggleMobile = document.getElementById('dark-mode-toggle-mobile');
        const body = document.body;
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            body.classList.add('dark-mode');
            if (darkModeToggleMobile) darkModeToggleMobile.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            if (darkModeToggleMobile) darkModeToggleMobile.innerHTML = '<i class="fas fa-moon"></i>';
        }
        function toggleDarkMode() {
            const isCurrentlyDark = body.classList.contains('dark-mode');
            if (isCurrentlyDark) {
                body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'false');
                if (darkModeToggleMobile) darkModeToggleMobile.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'true');
                if (darkModeToggleMobile) darkModeToggleMobile.innerHTML = '<i class="fas fa-sun"></i>';
            }
            applyBackground(getPageKey());
        }

        if (darkModeToggleMobile) {
            darkModeToggleMobile.addEventListener('click', (e) => {
                e.preventDefault();
                toggleDarkMode();
            });
        }
    }

    function initializeBackToTop() {
        const backToTopButton = document.getElementById('back-to-top');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) backToTopButton.classList.add('show'); else backToTopButton.classList.remove('show');
        });
        backToTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }

    function initializeHamburgerAutoClose() {
        const burger = document.querySelector('.navbar-burger');
        const menu = document.querySelector('.navbar-menu');
        if (!burger || !menu) return;
        document.addEventListener('click', (e) => {
            if (!menu.contains(e.target) && menu.classList.contains('is-active')) {
                menu.classList.add('is-closing');
                setTimeout(() => {
                    menu.classList.remove('is-active');
                    menu.classList.remove('is-closing');
                    burger.classList.remove('is-active');
                }, 100);
            }
        });
    }

    function initializeNavbarResizeReset() {
        const navbarMenu = document.querySelector('.navbar-menu');
        const navbarBurger = document.querySelector('.navbar-burger');
        if (!navbarMenu || !navbarBurger) return;

        let wasDesktop = window.innerWidth >= 1024;

        function resetState() {
            navbarMenu.classList.remove('is-active', 'is-closing');
            navbarBurger.classList.remove('is-active');
        }

        if (wasDesktop) resetState();

        window.addEventListener('resize', () => {
            const isDesktop = window.innerWidth >= 1024;
            if (isDesktop && !wasDesktop) {
                resetState();
            }
            wasDesktop = isDesktop;
        });
    }
    function initializeHomeLink() {
        const home = document.getElementById('navbar-home');
        if (home) {
            home.addEventListener('click', (e) => {
                e.preventDefault();
                goTo('home');
            });
        }
    }

    window.addEventListener('popstate', () => renderPage().then(() => applyBackground(getPageKey())));

    document.addEventListener('DOMContentLoaded', () => {
        // 多页容器
        renderPage().then(() => applyBackground(getPageKey()));
        initializeLanguageDropdown();
        initializeLayoutMode();
        initializeDarkMode();
        initializeBackToTop();
        initializeHomeLink();
        wireNavLinks();
        initializeHamburgerAutoClose();
        initializeNavbarResizeReset();
    });
</script>

</html>
