<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multipage - Zhe Xu - Homepage</title>

    <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./static/css/bulma.min.css">
    <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
    <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
    <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
    <link rel="stylesheet" href="./static/css/index.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script defer src="./static/js/fontawesome.all.min.js"></script>
    <script src="./static/js/bulma-carousel.min.js"></script>
    <script src="./static/js/bulma-slider.min.js"></script>
    <script src="./static/js/index.js"></script>
</head>

<body>

    <div id="background-container"
        style="background-image:linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)),url('./media/occupacy.jpg');background-size: cover; background-position: center;background-attachment: fixed;padding-top: 52px; padding-bottom: 20px; margin-top: -52px; width: 100vw; position: relative; min-height: 100vh;">
        <nav class="navbar is-primary">
            <div class="navbar-brand">
                <a class="navbar-item" href="#" id="navbar-home">
                    <strong id="navbar-title">Home</strong>
                </a>

                <a class="navbar-item dark-mode-toggle-mobile" href="#" id="dark-mode-toggle-mobile"
                    title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </a>

                <a class="navbar-item layout-mode-toggle" href="#" id="layout-mode-toggle"
                    title="Switch to Single-page Mode">
                    <i class="fas fa-file-alt"></i>
                </a>

                <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="top-navbar">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>

            <div id="top-navbar" class="navbar-menu">
                <div class="navbar-end">
                    <a class="navbar-item" href="?page=about" id="navbar-about">About Me</a>
                    <a class="navbar-item" href="?page=news" id="navbar-news">News</a>
                    <a class="navbar-item" href="?page=publications" id="navbar-publications">Publications</a>
                    <a class="navbar-item" href="?page=projects" id="navbar-projects">Projects</a>
                    <a class="navbar-item" href="?page=blogs" id="navbar-blogs">Blogs</a>
                    <div class="navbar-item has-dropdown" id="language-dropdown">
                        <a class="navbar-link" id="navbar-language"><span id="lang-label">Language</span><i
                                class="fas fa-chevron-left lang-arrow"></i></a>
                        <div class="navbar-dropdown" id="language-dropdown-menu"></div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container is-max-desktop" id="content-root" style="min-height: calc(100vh - 120px);">
            <!-- 动态内容容器 -->
        </div>

        <footer class="footer" style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000;">
            <div class="container">
                <div class="columns is-centered">
                    <div class="column">
                        <div class="content has-text-centered">
                            <p id="footer-text">Edit by Joshua@2025.9.27</p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <button id="back-to-top" class="back-to-top" title="返回顶部">
            <i class="fas fa-chevron-up"></i>
        </button>
    </div>

</body>

<script>
    let currentLang = localStorage.getItem('lang') || 'en';
    let availableLanguages = ['en', 'zh', 'jp'];

    function getPageKey() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('page') || 'home';
    }

    async function loadWebContent(lang = currentLang) {
        const res = await fetch(`data/${lang}/web_content.json`);
        return await res.json();
    }

    function updateElement(selector, html) {
        const element = document.querySelector(selector);
        if (element) element.innerHTML = html;
    }

    function generateLanguageButtons(webContent) {
        const langDropdown = document.querySelector('#language-dropdown');
        const wasOpen = langDropdown && langDropdown.classList.contains('is-active');
        const dropdown = document.querySelector('#language-dropdown-menu');
        dropdown.innerHTML = '';
        availableLanguages.forEach(lang => {
            const langKeyMap = { 'en': 'english', 'zh': 'chinese', 'jp': 'japanese' };
            const langKey = langKeyMap[lang];
            const langName = webContent[langKey] || lang;
            const button = document.createElement('a');
            button.className = 'navbar-item';
            button.onclick = (e) => { e.stopPropagation(); switchLanguage(lang); };
            button.innerHTML = langName;
            dropdown.appendChild(button);
        });
        // 恢复原先展开状态（避免PC端切换语言后收起）
        if (langDropdown && wasOpen) {
            langDropdown.classList.add('is-active');
        }
    }

    function switchLanguage(lang) {
        localStorage.setItem('lang', lang);
        currentLang = lang;
        const dropdown = document.querySelector('#language-dropdown');
        const wasOpen = dropdown && dropdown.classList.contains('is-active');
        renderPage().then(() => {
            const dd = document.querySelector('#language-dropdown');
            if (dd && wasOpen) dd.classList.add('is-active');
        });
    }

    function goTo(page) {
        const url = new URL(window.location.href);
        url.searchParams.set('page', page);
        window.history.pushState({}, '', url.toString());
        renderPage();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function wireNavLinks() {
        const links = document.querySelectorAll('.navbar-item[href^="?page="]');
        links.forEach(a => {
            a.addEventListener('click', (e) => {
                e.preventDefault();
                const href = a.getAttribute('href');
                const m = /[?&]page=([^&#]+)/.exec(href);
                if (m && m[1]) goTo(m[1]);
            });
        });
    }

    async function renderPage() {
        // 确保使用最新语言
        currentLang = localStorage.getItem('lang') || currentLang || 'en';
        const page = getPageKey();
        const webContent = await loadWebContent(currentLang);

        updateElement('#navbar-title', webContent.navbar_title);
        updateElement('#navbar-home', webContent.navbar_home);
        updateElement('#navbar-about', webContent.navbar_about);
        updateElement('#navbar-news', webContent.navbar_news);
        updateElement('#navbar-publications', webContent.navbar_publications);
        updateElement('#navbar-projects', webContent.navbar_projects);
        updateElement('#navbar-blogs', webContent.navbar_blogs);
        updateElement('#navbar-language', webContent.language);
        updateElement('#footer-text', webContent.footer);
        generateLanguageButtons(webContent);

        const root = document.getElementById('content-root');
        root.innerHTML = '';

        // 切换前，先恢复滚动，避免禁用遗留
        document.documentElement.classList.remove('mp-home-fixed');
        document.body.classList.remove('mp-home-fixed');

        if (page === 'home') {
            // 首页在所有端禁用滚动
            document.documentElement.classList.add('mp-home-fixed');
            document.body.classList.add('mp-home-fixed');
            const container = document.createElement('div');
            container.className = 'container has-text-centered';
            container.innerHTML = `
        <div style="display: flex; justify-content: center; align-items: center; height: 300px;">
          <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
            <figure class="image is-128x128 is-inline-block" style="width: 200px; height: 200px; margin: 0;">
              <img class="is-rounded" src="./media/personal.jpg" alt="Avatar" style="width: 100%; height: 100%;">
            </figure>
          </div>
        </div>
        <h1 class="title is-size-3-tablet is-size-4-mobile" style="font-family: Futura;" id="main-title"></h1>
        <p class="subtitle is-size-4-tablet is-size-5-mobile" style="font-family: Brush Script MT;" id="main-subtitle"></p>
        <div class="icon-box">
          <a href="https://github.com/Phospheneser" target="_blank"><i class="fab fa-github"></i></a>
          <a href="https://scholar.google.com/citations?user=TSUlagkAAAAJ&hl=zh-CN" target="_blank"><i class="fas fa-graduation-cap"></i></a>
          <a href="https://x.com/PhospheneserXu" target="_blank"><i class="fab fa-twitter"></i></a>
          <a href="mailto:zxu24@m.fudan.edu.cn"><i class="fas fa-envelope"></i></a>
        </div>`;
            root.appendChild(container);
            updateElement('#main-title', webContent.title);
            updateElement('#main-subtitle', webContent.subtitle);
        } else if (page === 'about') {
            // 其他页面保持滚动开启（已在开头处理）
            const [academicServiceRes] = await Promise.all([
                fetch(`data/${currentLang}/academic_service.json`)
            ]);
            const academicService = await academicServiceRes.json();
            const container = document.createElement('div');
            container.innerHTML = `
        <section class="section" name="sec-intro">
          <div id="about">
            <h1 class="title is-3" id="about-title" style="margin-top: 60px;">🎄 About Me</h1>
          </div>
          <div>
            <p class="text-homepage-1" id="about-text1"></p>
            <p class="text-homepage-1" id="about-text2"></p>
          </div>
        </section>`;
            root.appendChild(container);
            updateElement('#about-title', webContent.about_title);
            updateElement('#about-text1', webContent.about_text1);
            updateElement('#about-text2', webContent.about_text2);
        } else if (page === 'news') {
            const [newsRes] = await Promise.all([
                fetch(`data/${currentLang}/news.json`)
            ]);
            const news = await newsRes.json();
            const list = news.news || [];
            const container = document.createElement('div');
            container.innerHTML = `
        <section class="section" name="sec-news">
          <div id="news">
            <h1 class="title is-3" style="margin-bottom: 1ex; margin-top: 60px;" id="news-title">🔥 News</h1>
            <div></div>
          </div>
        </section>`;
            root.appendChild(container);
            updateElement('#news-title', webContent.news_title);
            const newsContainer = container.querySelector('#news').children[1];
            newsContainer.innerHTML = '';
            list.forEach(item => {
                const div = document.createElement('div');
                div.style.cssText = 'display: flex; justify-content: flex-start; align-items: center; margin-bottom: 15px;';
                div.innerHTML = `<span style="font-weight: bold; margin-right: 50px;">${item.date}</span><span style="font-family: Georgia">${item.content}</span>`;
                newsContainer.appendChild(div);
            });
        } else if (page === 'publications') {
            const [pubsRes] = await Promise.all([
                fetch(`data/${currentLang}/publications.json`)
            ]);
            const publications = await pubsRes.json();
            const pubs = publications.publications || [];
            const container = document.createElement('div');
            container.innerHTML = `
        <section class="section" name="sec-publications">
          <div id="publications">
            <h1 class="title is-3" style="margin-bottom: 1ex; margin-top: 60px;" id="publications-title">📑 Publications</h1>
            <div></div>
          </div>
        </section>`;
            root.appendChild(container);
            updateElement('#publications-title', webContent.publications_title);
            const contentDiv = container.querySelector('#publications').children[1];
            pubs.forEach(pub => {
                const paper = document.createElement('div');
                paper.className = 'paper-container';
                paper.innerHTML = `
          <img src="${pub.image}" alt="Overview" class="paper-image">
          <div class="paper-content">
            <h2 class="paper-title">${pub.title}</h2>
            ${pub.conference ? `<p class="paper-conf">${pub.conference}</p>` : ''}
            <p class="paper-authors">${pub.authors}</p>
            <p class="paper-description">${pub.description}</p>
            <p>${pub.links ? pub.links.map(l => `<a href="${l.url}" target="_blank" class="paper-link">[${l.type}]</a>`).join(' ') : ''}</p>
          </div>`;
                contentDiv.appendChild(paper);
            });
        } else if (page === 'projects') {
            const [projRes] = await Promise.all([
                fetch(`data/${currentLang}/projects.json`)
            ]);
            const projects = await projRes.json();
            const list = projects.projects || [];
            const container = document.createElement('div');
            container.innerHTML = `
        <section class="section" name="sec-projects">
          <div id="projects">
            <h1 class="title is-3" id="projects-title" style="margin-top: 60px;">⚙️ Projects</h1>
            <div></div>
          </div>
        </section>`;
            root.appendChild(container);
            updateElement('#projects-title', webContent.projects_title);
            const contentDiv = container.querySelector('#projects').children[1];
            list.forEach(proj => {
                const paper = document.createElement('div');
                paper.className = 'paper-container';
                const imageHtml = proj.image ? `<img src="${proj.image}" alt="Overview" class="paper-image">` : '<div class="paper-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; height: 150px;">No Image</div>';
                paper.innerHTML = `
          ${imageHtml}
          <div class="paper-content">
            <h2 class="paper-title" style="display: flex; justify-content: space-between; align-items: center;">
              ${proj.title}
              <span style="margin-left: auto; font-size: 16px;">${proj.date}</span>
            </h2>
            <p class="paper-authors">${proj.authors}</p>
            <p class="paper-description">${proj.description}</p>
            ${proj.links ? `<p>${proj.links.map(l => `<a href="${l.url}" target="_blank" class="paper-link">[${l.type}]</a>`).join(' ')}</p>` : ''}
          </div>`;
                contentDiv.appendChild(paper);
            });
        } else if (page === 'blogs') {
            const [blogsRes] = await Promise.all([
                fetch(`data/${currentLang}/blogs.json`)
            ]);
            const blogs = await blogsRes.json();
            const list = blogs.blogs || [];
            const container = document.createElement('div');
            container.innerHTML = `
        <section class="blogs">
          <div id="blogs">
            <h1 class="title is-3" style="margin-bottom: 1ex; margin-top: 60px;" id="blogs-title">Blogs</h1>
            <div></div>
          </div>
        </section>`;
            root.appendChild(container);
            updateElement('#blogs-title', webContent.blogs_title);
            const contentDiv = container.querySelector('#blogs').children[1];
            if (list.length === 0) {
                contentDiv.innerHTML = '<p>No blog posts yet.</p>';
            } else {
                list.forEach(blog => {
                    const blogContainer = document.createElement('div');
                    blogContainer.className = 'paper-container';
                    let linksHtml = '';
                    if (blog.links && blog.links.length > 0) {
                        linksHtml = blog.links.map(link => `<a href="${link.url}" target="_blank" rel="noopener noreferrer" class="paper-link" style="margin-right: 10px;">[${link.type}]</a>`).join('');
                    }
                    const imageHtml = blog.image ? `<img src="${blog.image}" alt="${blog.title}" class="paper-image">` : `<div class=\"paper-image\" style=\"background: #f0f0f0; display: flex; align-items: center; justify-content: center; height: 150px; color: #666;\">No Image</div>`;
                    blogContainer.innerHTML = `
            ${imageHtml}
            <div class="paper-content">
              <h2 class="paper-title" style="display: flex; justify-content: space-between; align-items: center;">
                ${blog.title}
                <span style="margin-left: auto; font-size: 16px; color: #666;">${blog.date}</span>
              </h2>
              <p class="paper-description blog-description">${blog.content}</p>
              <div>${linksHtml}</div>
            </div>`;
                    contentDiv.appendChild(blogContainer);
                });
            }
        }
    }

    function initializeLanguageDropdown() {
        const languageLink = document.querySelector('#navbar-language');
        const languageDropdown = document.querySelector('#language-dropdown');
        if (languageLink && languageDropdown) {
            // 初始保持收起
            languageDropdown.classList.remove('is-active');

            languageLink.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const willOpen = !languageDropdown.classList.contains('is-active');
                if (willOpen) {
                    languageDropdown.classList.remove('is-closing');
                    languageDropdown.classList.add('is-active');
                } else {
                    languageDropdown.classList.add('is-closing');
                    setTimeout(() => {
                        languageDropdown.classList.remove('is-active');
                        languageDropdown.classList.remove('is-closing');
                    }, 350);
                }
            });
            document.addEventListener('click', (e) => {
                if (!languageDropdown.contains(e.target) && languageDropdown.classList.contains('is-active')) {
                    languageDropdown.classList.add('is-closing');
                    setTimeout(() => {
                        languageDropdown.classList.remove('is-active');
                        languageDropdown.classList.remove('is-closing');
                    }, 350);
                }
            });
        }
    }

    function initializeLayoutMode() {
        const layoutModeToggle = document.getElementById('layout-mode-toggle');
        if (layoutModeToggle) {
            layoutModeToggle.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.setItem('layoutMode', 'single');
                window.location.href = 'index.html?scroll=top';
            });
        }
    }

    function initializeDarkMode() {
        const darkModeToggleMobile = document.getElementById('dark-mode-toggle-mobile');
        const body = document.body;
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            body.classList.add('dark-mode');
            if (darkModeToggleMobile) darkModeToggleMobile.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            if (darkModeToggleMobile) darkModeToggleMobile.innerHTML = '<i class="fas fa-moon"></i>';
        }
        function toggleDarkMode() {
            const isCurrentlyDark = body.classList.contains('dark-mode');
            const backgroundContainer = document.getElementById('background-container');
            if (isCurrentlyDark) {
                body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'false');
                backgroundContainer.style.backgroundImage = "linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)),url('./media/occupacy.jpg')";
                if (darkModeToggleMobile) darkModeToggleMobile.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'true');
                const darkImage = new Image();
                darkImage.onload = function () {
                    backgroundContainer.style.backgroundImage = "linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)),url('./media/occupacy_dark.jpg')";
                };
                darkImage.onerror = function () { };
                darkImage.src = './media/occupacy_dark.jpg';
                if (darkModeToggleMobile) darkModeToggleMobile.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        if (darkModeToggleMobile) {
            darkModeToggleMobile.addEventListener('click', (e) => {
                e.preventDefault();
                toggleDarkMode();
            });
        }
    }

    function initializeBackToTop() {
        const backToTopButton = document.getElementById('back-to-top');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) backToTopButton.classList.add('show'); else backToTopButton.classList.remove('show');
        });
        backToTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }

    function initializeHamburgerAutoClose() {
        const burger = document.querySelector('.navbar-burger');
        const menu = document.querySelector('.navbar-menu');
        if (!burger || !menu) return;
        document.addEventListener('click', (e) => {
            if (!menu.contains(e.target) && menu.classList.contains('is-active')) {
                menu.classList.add('is-closing');
                setTimeout(() => {
                    menu.classList.remove('is-active');
                    menu.classList.remove('is-closing');
                    burger.classList.remove('is-active');
                }, 100);
            }
        });
    }
    function initializeHomeLink() {
        const home = document.getElementById('navbar-home');
        if (home) {
            home.addEventListener('click', (e) => {
                e.preventDefault();
                goTo('home');
            });
        }
    }

    window.addEventListener('popstate', () => renderPage());

    document.addEventListener('DOMContentLoaded', () => {
        // 多页容器
        renderPage();
        // 监听窗口尺寸变化：先恢复，再按需禁用
        window.addEventListener('resize', () => {
            const page = getPageKey();
            document.documentElement.classList.remove('mp-home-fixed');
            document.body.classList.remove('mp-home-fixed');
            if (page === 'home') {
                document.documentElement.classList.add('mp-home-fixed');
                document.body.classList.add('mp-home-fixed');
            }
        });
        initializeLanguageDropdown();
        initializeLayoutMode();
        initializeDarkMode();
        initializeBackToTop();
        initializeHomeLink();
        wireNavLinks();
        initializeHamburgerAutoClose();
    });
</script>

</html>